<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">
    <title>Top 10 Blogs | Mevin Babu</title>
    <!-- Bootstrap core CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
            <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
    <style type="text/css">
    .row-eq-height {
        display: -webkit-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex;
    }

    .center-list-index {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .list-counter-container {
        display: flex;
        border-radius: 50%;
        border-width: 0.2em;
        border-color: black;
        border-style: solid;
        justify-content: center;
        align-items: center;
        padding: 0.4rem 1rem;
    }

    .article-text-content {
        text-align: justify;
    }

    .article-published-date {
        color: #cecece;
    }

    .article-preview-title {
        position: absolute;
        bottom: 0.2em;
        color: white;
        background-color: rgba(0, 0, 0, 0.4);
        padding: 0.2em 0.5em;
    }

    .article-title:first-letter {
        text-transform: capitalize;
    }

    .article-header-img,
    .article-header-img-thumbnail,
    .article-content-img {
        height: 280px;
        overflow: hidden;
        background-size: cover;
        background-position: center;
        position: relative;
        margin-bottom: 1em;
    }

    .article-header-img-thumbnail {
        max-height: 15vw;
    }

    .article-content-img {
        width: 100%;
    }
    </style>
</head>

<body>
    <div class="container">
        <div class="row">
            <!-- Side Navigation -->
            <div class="col-xs-2" id="sidebar">
                {% include "nav.html"%}
            </div>
            <div class="col-xs-10">
                <div id="ArticleViewArea"></div>
                <!-- What to read next -->
                <div class="row">
                    {% include "read_next.html"%}
                </div>
            </div>
        </div>
    </div>
    <hr>
    <footer>
        <p>&copy; 2015 Company, Inc.</p>
    </footer>
    </div>
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/underscore-min.js"></script>
    <script src="/static/js/backbone-min.js"></script>
    <!-- Post Preview -->
    <script type="text/template" class=ArticleRandomTemplate>
        <h1>Top 10 List</h1>
        <h4 class="article-published-date">
            <small><%= new Date(article.published_at).toString().slice(0, 15) %></small> |
            <span class="text-primary"><%= article.author %></span>
        </h4>
        <!-- <img src="<%= article.hero_image %>" class="img-responsive center-block article-preview"> -->
        <div style="background-image:url('<%= article.hero_image %>');" class="article-header-img">
            <h1 class="article-preview-title article-title"><%= article.title %>
            <a href="/#/<%= article.slug %>" class="btn btn-primary btn-lg" role="button">Read more &raquo;</a>
            </h1>
        </div>
        <p class="article-text-content">
            <%= article.snippet %>
        </p>
    </script>
    <!-- Underscore template to show Top 10 posts -->
    <script type="text/template" class=ArticleTopListTemplate>
        <% _.each(articles, function(article, key, list) { %>
            <div class="row-eq-height">
                <div class="col-xs-1 col-sm-2 center-list-index">
                    <span class="list-counter-container"><%= key+1 %></span>
                </div>
                <div class="col-xs-11 col-sm-10">
                    <h3 class="article-title"><%= article.attributes.title %></h3>
                    <p class="article-text-content">
                        <%= article.attributes.snippet %>
                    </p>
                    <p><a href="/#/<%= article.attributes.slug %>" role="button">Read more &raquo;</a></p>
                </div>
            </div>
            <% }); %>
    </script>
    <!-- underscore Template to view a blog post -->
    <script type="text/template" class='ArticleDetailTemplate'>
        <h1 class="article-title"><%= article.title %></h1>
        <h4 class="article-published-date">
            <small><%= new Date(article.published_at).toString().slice(0, 15) %></small> |
            <span class="text-primary"><%= article.author %></span>
        </h4>
        <div style="background-image:url('<%= article.hero_image %>');" class="article-header-img"></div>
        <% var body = article.body.replace(/\n/g,'<br />').replace(/\t/g,'&nbsp;&nbsp;&nbsp;'); %>
            <div class="row">
                <div class="col-xs-8">
                    <p class="article-text-content">
                        <%= body %>
                    </p>
                </div>
                <div class="col-xs-4">
                    <!-- <div style="background-image:url('<%= article.content_image %>');" class="article-content-img"></div> -->
                    <img src="<%= article.content_image %>" class="img-responsive center-block">
                </div>
            </div>
    </script>
    <script type="text/javascript">
    // Models
    var Article = Backbone.Model.extend({
        idAttribute: "slug",
        urlRoot: '/articles'
    });
    var ArticleList = Backbone.Collection.extend({
        url: '/articles',
        model: Article
    });

    var articles = new ArticleList;

    // Views
    var ArticleDetailView = Backbone.View.extend({
        model: '',
        el: $("#ArticleViewArea"),
        render: function() {
            var template = _.template($("script.ArticleDetailTemplate").html());
            this.$el.html(template({
                article: this.model.attributes,
            }));
            return this;
        }
    });

    var RandomArticleView = Backbone.View.extend({
        model: '',
        el: $("#ArticleViewArea"),
        initialize: function(args) {
            this.render()
        },
        render: function() {
            this.$el.html('')
            var template = _.template($("script.ArticleRandomTemplate").html());
            this.$el.html(template({
                article: this.model.attributes,
            }));
            return this;
        }
    });

    var ArticleListView = Backbone.View.extend({
        model: ArticleList,
        el: $("#ArticleViewArea"),
        initialize: function() {
            this.render();
        },
        render: function() {
            var template = _.template($("script.ArticleTopListTemplate").html());
            this.$el.append(template({
                articles: this.model
            }));
            return this
        }
    });


    // Router
    var AppRouter = Backbone.Router.extend({
        routes: {
            "": "index",
            ":slug": "viewArticle",
        }
    });

    var app_router = new AppRouter;

    // route to load the articleList page
    app_router.on('route:index', function() {
        if(article){
            article = null
            fetch_recommended_articles()
        }

        // Get the preview article
        var preview_article = new Article()
        preview_article.url = 'articles/preview/'
        preview_article.fetch({
            success: function(model, response, options) {
                var random_article = new RandomArticleView({
                    model: model
                })
            }
        });

        // Fetch the top 10 posts
        articles.fetch({
            success: function(collection, response, options) {
                var blog_view = new ArticleListView({
                    model: collection.models
                });
            }
        });
        document.title = "Top 10 Blogs | Mevin Babu"
    });

    // Route to load the details page
    var article = null
    app_router.on('route:viewArticle', function(slug) {
        article = new Article({
            slug: slug
        })

        // Fetch the article to view
        article.fetch({
            success: function(model, response, options) {
                var article_view = new ArticleDetailView({
                    model: model,
                })
                article_view.render()
                document.title = model.attributes.title + " | " + model.attributes.author
                fetch_recommended_articles()
            }
        })
    });


    // make the URLs bookmarkable
    Backbone.history.start();
    </script>
</body>

</html>
